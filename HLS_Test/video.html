<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Video.js | HTML5 Video Player</title>
	<link href="Video.js/v7.10.2/video-js.min.css" rel="stylesheet">
	<script src="Video.js/v7.10.2/video.min.js"></script>
	<script type="text/javascript" defer>
		var chapterDataLastModified = null;

		window.addEventListener(
			"load",
			function () {
				var httpRequest = new XMLHttpRequest();
				httpRequest.onreadystatechange = function () {
					if (this.readyState == 4 && (this.status == 200 || this.status == 304)) {
						if (this.status == 200) {
							var responseXml = this.responseXML;
							//TODO: Handle <group> elements
							var chapterSelector = document.getElementById("ChapterSelector");
							var chapterElements = responseXml.getElementsByTagName("chapter");
							var fragment = document.createDocumentFragment();

							for (var i = 0; i < chapterElements.length; ++i) {
								var chapterElement = chapterElements[i];
								var chapterAttributes = chapterElement.attributes;
								//TODO: Handle missing or invalid offset values
								//TODO: Handle offset values in hh:mm:ss format
								var chapterOffsetText = chapterAttributes.getNamedItem("offset").value;
								//TODO: Handle missing or empty title values
								var chapterTitle = chapterAttributes.getNamedItem("title").value.trim();
								var option = new Option(chapterTitle, chapterOffsetText);

								fragment.appendChild(option);
							}

							chapterSelector.appendChild(fragment);
						}

						chapterDataLastModified = this.getResponseHeader("Last-Modified");
					}
				};
				//httpRequest.setRequestHeader("If-Modified-Since", "");
				httpRequest.open("GET", "chapters.xml", true);
				httpRequest.send();

				var hasNativeHlsSupport = videojs.browser.IS_EDGE || videojs.browser.IS_ANY_SAFARI;
				var player = videojs(
					'player',
					{
						autoplay: false,
						controls: true,
						fluid: true,
						html5: {
							vhs: {
								//bandwidth: 6291456,
								overrideNative: !hasNativeHlsSupport,
								//enableLowInitialPlaylist: true,
								smoothQualityChange: true
							}
						},
						liveui: true,
						playbackRates: [1, 1.1, 1.2, 1.3, 1.4, 1.5, 2],
						preload: 'metadata'
					}
				);
				var startOffset = 0; // 0:00
				var configurePlayer = function () {
					var container = document.getElementById("playerContainer");

					//container.style.maxWidth = player.videoWidth() + "px";

					if (!hasNativeHlsSupport) {
						player.currentTime(startOffset);
					}
				};
			}
		);

		// wait for video metadata to load, then set time 
		player.on(
			"loadedmetadata",
			function () {
				configurePlayer();
			}
		);

		var isInitialized = false;

		// iPhone/iPad need to play first, then set the time
		// events: https://www.w3.org/TR/html5/embedded-content-0.html#mediaevents
		player.on(
			"canplaythrough",
			function () {
				if (!isInitialized) {
					configurePlayer();

					isInitialized = true;
				}
			}
		);

		function JumpToSelectedChapter() {
			//TODO: Allow chapters offsets to be specified as hh:mm:ss
			var chapterStartOffset = parseInt(ChapterSelector.value);
			var player = videojs('player');

			player.currentTime(chapterStartOffset);
		}
	</script>
	<style type="text/css">
		#ChapterSeekControls {
			margin-bottom: 1em;
			margin-top: 1em;
		}
	</style>
</head>

<body>
	<div id="ChapterSeekControls">
		<label for="ChapterSelector">Jump to:</label>
		<select id="ChapterSelector">
			<!--
			<option value="0">Pregame</option>
			<optgroup label="1st half">
				<option value="159">1st half kickoff</option>
				<option value="2045">Start of 2nd quarter</option>
			</optgroup>
			<option value="3828">Halftime</option>
			<optgroup label="2nd half">
				<option value="4142">2nd half kickoff</option>
				<option value="5762">Start of 4th quarter</option>
				<option value="8213">End of 4th quarter</option>
			</optgroup>
-->
		</select>
		<button onclick="JumpToSelectedChapter()">Go</button>
	</div>
	<div id="playerContainer">
		<video-js id="player">
			<source src="video/master.m3u8" type="application/vnd.apple.mpegurl" />
			<p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser
				that
				<a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
			</p>
		</video-js>
	</div>
</body>

</html>